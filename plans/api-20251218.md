# API Change Plans for llm-json-stream
> Written on 2025-12-18

This document outlines the planned API changes for the `llm-json-stream` package based on the changelog entries up to version 0.1.0.

## The Target API
### 1. Setup:
```typescript
interface User {
    name: string;
    age: number;
    email: string;
}

interface UsersResponse {
    label: string;
    description: string;
    users: User[];
}

// The LLM is told to write a JSON of users list
const response = await llm.sendPrompt(prompt);
```

### 2. Creating an instance:
```typescript
const usersAsync = parse<UsersResponse>(response);
```
- This allows for a schema to be enforced
- This empowers TypeScript users with autocomplete
- This lets Javascript users to not define types

### 3. Property Access:
```typescript
// Promises
const label = await usersAsync.label;

// Streaming chunks
for await (const chunk of usersAsync.description) {
    console.log(chunk);
}

// Streaming array items
for await (const user of usersAsync.users) {
    // [user] is an AsyncJson<User>
    for await (const nameChunk of user.name) {
        console.log(nameChunk);
    }
}

// Streaming final array items
for await (const user of usersAsync.users.final) {
    console.log(`User: ${await user.name}, Age: ${await user.age}`);
}

// Deep nested access
const firstUserEmail = await usersAsync.users[0].email;
```
- This largely simplifies the API
- This also removes a lot of boierplate

### 4. Type Safety
```typescript
// Inferred as string due to schema
const name = await usersAsync.users[0].name;

// Inferred as AsyncJson<number>
const ageAsync = usersAsync.users[0].age;
```
## Side-To-Side Preview of the API Change
Lets say this is for a blog response:
### Current API
```typescript
const parser = new JsonStreamParser(response);

const label = await parser.getStringProperty('label').promise;

for await (const chunk of parser.getStringProperty('description')) {
    console.log(chunk);
}
```
### New API
```typescript
const blog = JsonStream.parse<BlogResponse>(response);

const label = await blog.label;

for await (const chunk of blog.description) {
    console.log(chunk);
}
```

## Steps to Transition to the New API
1. Implement late-binding parsing to support the new `parse<T>` function
2. 

## Questions to answer
1. What is the new name for `JsonStreamParser`?
2. What is the new name for `PropertyStream` and its subclasses?